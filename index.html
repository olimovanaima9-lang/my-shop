<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>My Shop</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
body{
  font-family:Arial;
  background:#f2f2f2;
  margin:0;
  padding:10px;
}
.card{
  background:white;
  padding:15px;
  margin-bottom:15px;
  border-radius:12px;
}
button{
  background:#6c4cff;
  color:white;
  border:none;
  padding:8px 15px;
  border-radius:8px;
  cursor:pointer;
}
.qty-box{
  display:flex;
  gap:10px;
  align-items:center;
  margin-top:10px;
}
.cart-box{
  background:white;
  padding:15px;
  border-radius:12px;
  margin-top:20px;
}
</style>
</head>
<body>

<h2>üõí My Shop</h2>

<div id="products"></div>

<div class="cart-box">
  <h3>Savat</h3>
  <div id="cart"></div>
  <h4 id="total"></h4>
  <button onclick="confirmOrder()">Buyurtma berish</button>
</div>

<script>
const tg = window.Telegram.WebApp
tg.expand()

let cart = []

const products = [
  { id:1, name:"WK-609", price:48 },
  { id:2, name:"E406S", price:42 },
  { id:3, name:"TJQ-900", price:91 }
]

function renderProducts(){
  const container = document.getElementById("products")
  container.innerHTML=""

  products.forEach(p=>{
    container.innerHTML+=`
      <div class="card">
        <h3>${p.name}</h3>
        <p>${p.price} USD</p>
        <button onclick="selectQty(${p.id})">Savatga qo‚Äòshish</button>
        <div id="qty-${p.id}"></div>
      </div>
    `
  })
}

function selectQty(id){
  const box = document.getElementById("qty-"+id)
  box.innerHTML=`
    <div class="qty-box">
      <button onclick="changeQty(${id},-1)">-</button>
      <span id="count-${id}">1</span>
      <button onclick="changeQty(${id},1)">+</button>
      <button onclick="addToCart(${id})">Qo‚Äòshish</button>
    </div>
  `
}

function changeQty(id,val){
  const el = document.getElementById("count-"+id)
  let count = parseInt(el.innerText)
  count += val
  if(count<1) count=1
  el.innerText=count
}

function addToCart(id){
  const qty = parseInt(document.getElementById("count-"+id).innerText)
  const product = products.find(p=>p.id===id)

  const existing = cart.find(i=>i.id===id)
  if(existing){
    existing.qty += qty
  }else{
    cart.push({...product, qty})
  }

  renderCart()
  document.getElementById("qty-"+id).innerHTML=""
}

function renderCart(){
  const box = document.getElementById("cart")
  box.innerHTML=""

  cart.forEach(item=>{
    box.innerHTML+=`
      <p>${item.name} x ${item.qty} = ${item.price*item.qty} USD
      <button onclick="removeItem(${item.id})">‚ùå</button>
      </p>
    `
  })

  document.getElementById("total").innerText =
    "Jami: "+getTotal()+" USD"
}

function removeItem(id){
  cart = cart.filter(i=>i.id!==id)
  renderCart()
}

function getTotal(){
  return cart.reduce((sum,i)=>sum+i.price*i.qty,0)
}

function confirmOrder(){
  if(cart.length===0){
    alert("Savat bo‚Äòsh")
    return
  }

  const data = {
    items: cart,
    total: getTotal()
  }

  tg.sendData(JSON.stringify(data))
  tg.close()
}

renderProducts()
</script>

</body>
</html>
