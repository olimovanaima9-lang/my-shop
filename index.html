<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<title>My Shop</title>

<style>
body{margin:0;font-family:sans-serif;background:#f5f6f8;padding-bottom:80px}
.header{padding:20px;font-size:22px;font-weight:700}
.section{padding:0 15px;font-weight:600;margin-top:10px}
.products{display:flex;overflow-x:auto;gap:15px;padding:15px}
.card{min-width:180px;background:white;border-radius:18px;padding:10px;box-shadow:0 4px 10px rgba(0,0,0,0.05)}
.card img{width:100%;height:120px;object-fit:cover;border-radius:12px}
.price{font-weight:700;margin-top:5px}
.btn{background:#6C4CF1;color:white;border:none;padding:8px;width:100%;border-radius:10px;margin-top:8px}
.qtyBox{display:flex;justify-content:space-between;align-items:center;margin-top:8px}
.qtyBox button{width:35px;height:30px;border:none;background:#6C4CF1;color:white;border-radius:8px}
.bottom{position:fixed;bottom:0;width:100%;background:white;display:flex;justify-content:space-around;padding:10px 0;box-shadow:0 -5px 15px rgba(0,0,0,0.08)}
.bottom div{font-size:12px}
.cartCount{background:red;color:white;font-size:10px;padding:2px 6px;border-radius:10px}
</style>
</head>

<body>

<div class="header">üõç My Shop</div>

<div class="section">Mashhur</div>

<div class="products" id="products"></div>

<div class="bottom">
<div onclick="showHome()">Bosh sahifa</div>
<div onclick="showCart()">Savat <span id="cartCount" class="cartCount">0</span></div>
<div onclick="showProfile()">Profil</div>
</div>

<script>
const tg = window.Telegram.WebApp;
tg.expand();

let products = [
{id:1,name:"WK-609",price:48,img:"https://images.unsplash.com/photo-1583267746897-2cf415887172"},
{id:2,name:"E406S",price:42,img:"https://images.unsplash.com/photo-1606813907291-d86efa9b94db"},
{id:3,name:"TJQ-900",price:91,img:"https://images.unsplash.com/photo-1595433707802-7f92f9b32f67"}
];

let cart = {};

function renderProducts(){
let html="";
products.forEach(p=>{
html+=`
<div class="card">
<img src="${p.img}">
<div class="price">${p.price} USD</div>
<div>${p.name}</div>
<button class="btn" onclick="addToCart(${p.id})">Savatga qo'shish</button>
</div>`;
});
document.getElementById("products").innerHTML=html;
}
renderProducts();

function addToCart(id){
if(!cart[id]) cart[id]=1;
else cart[id]++;
updateCart();
}

function updateCart(){
let total=0;
for(let id in cart){ total+=cart[id]; }
document.getElementById("cartCount").innerText=total;
}

function showCart(){
let html="";
for(let id in cart){
let p = products.find(x=>x.id==id);
html+=`
<div class="card">
<img src="${p.img}">
<div>${p.name}</div>
<div class="qtyBox">
<button onclick="changeQty(${id},-1)">-</button>
<span>${cart[id]}</span>
<button onclick="changeQty(${id},1)">+</button>
</div>
<button class="btn" onclick="removeItem(${id})">Bekor qilish</button>
</div>`;
}
html+=`<button class="btn" onclick="order()">Buyurtma berish</button>`;
document.getElementById("products").innerHTML=html;
}

function changeQty(id,val){
cart[id]+=val;
if(cart[id]<=0) delete cart[id];
updateCart();
showCart();
}

function removeItem(id){
delete cart[id];
updateCart();
showCart();
}

function order(){
tg.sendData(JSON.stringify(cart));
tg.close();
}

function showHome(){
renderProducts();
}

function showProfile(){
document.getElementById("products").innerHTML=`
<div class="card">
<button class="btn" onclick="requestPhone()">Telefon raqamni kiritish</button>
</div>`;
}

function requestPhone(){
tg.requestContact();
}
</script>

</body>
</html>
